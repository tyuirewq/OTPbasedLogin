<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OTP Login with Firebase</title>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js"></script>
</head>
<body>
  <h2>OTP Login (Firebase)</h2>
  
  <input type="text" id="mobile" placeholder="+91XXXXXXXXXX"><br><br>
  <div id="recaptcha-container"></div><br>
  <button onclick="sendOTP()">Send OTP</button><br><br>

  <input type="text" id="otp" placeholder="Enter OTP"><br><br>
  <button onclick="verifyOTP()">Verify OTP</button>

  <p id="result"></p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBImV4-QroenwecFE2Nk53MeJGQt-aWE2o",
      authDomain: "studio-1263535307-205e6.firebaseapp.com",
      databaseURL: "https://studio-1263535307-205e6-default-rtdb.firebaseio.com",
      projectId: "studio-1263535307-205e6",
      storageBucket: "studio-1263535307-205e6.firebasestorage.app",
      messagingSenderId: "240447378915",
      appId: "1:240447378915:web:a69dc620dab3158851fcd6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Setup invisible reCAPTCHA
    window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {
      size: 'normal',
      callback: (response) => {
        console.log('reCAPTCHA solved');
      }
    });

    let confirmationResult;

    window.sendOTP = async function() {
      const phoneNumber = document.getElementById('mobile').value;
      try {
        confirmationResult = await signInWithPhoneNumber(auth, phoneNumber, window.recaptchaVerifier);
        document.getElementById('result').innerText = "OTP sent successfully ✅";
      } catch (error) {
        document.getElementById('result').innerText = "Error: " + error.message;
      }
    }

    window.verifyOTP = async function() {
      const otp = document.getElementById('otp').value;
      try {
        const result = await confirmationResult.confirm(otp);
        const user = result.user;
        document.getElementById('result').innerText = `Logged in as: ${user.phoneNumber}`;
      } catch (error) {
        document.getElementById('result').innerText = "Invalid OTP ❌";
      }
    }
  </script>
</body>
</html>
